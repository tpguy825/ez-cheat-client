package io.gitlab.scriptkid.ezcheatclient.fakecheats.FakeInvulnerability.mixin;

import io.gitlab.scriptkid.ezcheatclient.FakeCheat;
import io.gitlab.scriptkid.ezcheatclient.gui.CheatsMenuGui;
import net.minecraft.client.MinecraftClient;
import net.minecraft.client.gui.hud.InGameHud;
import net.minecraft.entity.attribute.EntityAttributes;
import net.minecraft.entity.player.PlayerEntity;
import org.spongepowered.asm.mixin.Mixin;
import org.spongepowered.asm.mixin.Shadow;
import org.spongepowered.asm.mixin.injection.At;
import org.spongepowered.asm.mixin.injection.Inject;
import org.spongepowered.asm.mixin.injection.ModifyVariable;
import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;
import org.spongepowered.asm.mixin.injection.callback.LocalCapture;

@Mixin(InGameHud.class)
public abstract class FakeInvulnerability_InGameHudMixin {

    @Shadow
    public abstract PlayerEntity getCameraPlayer();

    @ModifyVariable(method = "Lnet/minecraft/client/gui/hud/InGameHud;renderStatusBars(Lnet/minecraft/client/util/math/MatrixStack;)V", at = @At(value = "INVOKE_ASSIGN", target = "Lnet/minecraft/util/math/MathHelper;ceil(F)I", ordinal = 0))
    private int getHealth(int i) {
        if(FakeCheat.isActivated && CheatsMenuGui.btn_godemode.getToggle() == true) {
            PlayerEntity playerEntity = this.getCameraPlayer();
            int max_health = (int) playerEntity.getAttributeValue(EntityAttributes.GENERIC_MAX_HEALTH);
            return Math.max(max_health, 20);
        } else {
            return i;
        }
    }

}